#Daniel ence
#08/20/2020

include: "rules/common.smk"
include: "rules/trim.smk"
include: "rules/fastqc.smk"
include: "rules/align.smk"
include: "rules/gatk_indel.smk"
include: "rules/samtools_index.smk"
include: "rules/samtools_rmdup.smk"
include: "rules/samtools_sort.smk"

#rule all:
#    input:
#        "reports/dummy_report.html"

#rule dummy_report:
#    input:
#        get_fastqs
#    output:
#        "reports/dummy_report.html"
#    run:
#        from snakemake.utils import report
#
#        report("""
#        A first test of an alignment and variant calling pipeline for Fr1 data. T1_
#        """,output[0],T1=input)

def all_input(wildcards):
    """
    Function defining all requested inputs for the rule all (below).
    """

    wanted_input = []
    wanted_input.extend(
        expand(
            pd.read_csv(config["units"], sep="\t", dtype=str)["fq1"]
        )
    )

    wanted_input.extend(
        expand(
            pd.read_csv(config["units"], sep="\t", dtype=str)["fq2"]
        )

    )

    wanted_input.extend(
        expand(
            [
                "results/logs/fastqc_pre_out/{sample}-{unit}.log"
            ],
                sample=units["sample"],unit=units["unit"]

        )

    )

    wanted_input.extend(
        expand(
            [
                "results/trimmed/{sample}-{unit}.trimmed.R1.fastq.gz",
                "results/trimmed/{sample}-{unit}.trimmed.R2.fastq.gz"
            ],
                sample=units["sample"],unit=units["unit"]
        )

    )

    wanted_input.extend(
        expand(
            [
                "results/mapped_bwamem/{sample}-{unit}.bam"
            ],
                sample=units["sample"],unit=units["unit"]
        )
    )

    wanted_input.extend(
        expand(
            [
                "results/mapped_bwamem/{sample}-{unit}.bam"
            ],
                sample=units["sample"],unit=units["unit"]
        )

    )

    wanted_input.extend(
        expand(
            [
                "results/realigned/{sample}-{unit}.sorted.rmdup.realigned.bam.bai"
            ],
                sample=units["sample"],unit=units["unit"]

        )

    )

    return wanted_input


rule all:
    input: all_input
